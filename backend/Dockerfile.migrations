# Migrations Dockerfile - optimized
FROM alpine:3.19

# Install goose binary directly (much faster than go install)
RUN apk add --no-cache curl \
    && curl -fsSL https://github.com/pressly/goose/releases/download/v3.24.3/goose_linux_amd64 -o /usr/local/bin/goose \
    && chmod +x /usr/local/bin/goose \
    && apk del curl

WORKDIR /migrations

# Copy migration files
COPY migrations/*.sql ./

# Run migrations
CMD ["sh", "-c", "goose postgres \"$GOOSE_DBSTRING\" up"]
