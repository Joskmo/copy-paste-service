# Migrations Dockerfile - optimized
FROM golang:1.24-alpine AS builder

# Install goose
RUN go install github.com/pressly/goose/v3/cmd/goose@v3.24.1

# Final stage
FROM alpine:3.19

# Copy goose binary
COPY --from=builder /go/bin/goose /usr/local/bin/goose

WORKDIR /migrations

# Copy migration files
COPY migrations/*.sql ./

# Run migrations
CMD ["sh", "-c", "goose postgres \"$GOOSE_DBSTRING\" up"]
